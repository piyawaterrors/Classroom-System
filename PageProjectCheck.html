<style>
  @keyframes entry {
    from {
      opacity: 0;
      transform: translateY(10px);
    }

    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-entry {
    animation: entry 0.4s ease-out;
  }

  @keyframes zoomIn {
    from {
      opacity: 0;
      transform: scale(0.9) translateY(20px);
    }
    to {
      opacity: 1;
      transform: scale(1) translateY(0);
    }
  }

  .animate-zoomIn {
    animation: zoomIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
  }

  /* Custom Scrollbar */
  .custom-scrollbar::-webkit-scrollbar {
    width: 6px;
  }
  .custom-scrollbar::-webkit-scrollbar-track {
    background: transparent;
  }
  .custom-scrollbar::-webkit-scrollbar-thumb {
    background: #e2e8f0;
    border-radius: 10px;
  }
  .custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background: #cbd5e1;
  }

  /* Toast Notification */
  #toast-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 9999;
    pointer-events: none;
    width: 90%;
    max-width: 350px;
  }

  .toast {
    background: white;
    border-left: 4px solid #4f46e5;
    padding: 16px 24px;
    border-radius: 12px;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    margin-bottom: 10px;
    transform: translateX(120%);
    opacity: 0;
    transition: all 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
    display: flex;
    align-items: center;
    gap: 12px;
    pointer-events: auto;
    width: 100%;
  }

  .toast.show {
    transform: translateX(0);
    opacity: 1;
  }

  .toast.success {
    border-color: #10b981;
  }

  .toast.error {
    border-color: #ef4444;
  }

  /* Modal Animation */
  .modal-backdrop {
    transition: opacity 0.3s ease-out;
  }

  .modal-content {
    transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .modal-show .modal-backdrop {
    opacity: 1;
    pointer-events: auto;
  }

  .modal-show .modal-content {
    transform: scale(1);
    opacity: 1;
  }

  .modal-hide .modal-backdrop {
    opacity: 0;
    pointer-events: none;
  }

  .modal-hide .modal-content {
    transform: scale(0.95);
    opacity: 0;
  }

  /* Background Blobs */
  .blob {
    position: absolute;
    filter: blur(80px);
    opacity: 0.4;
    z-index: -1;
    animation: float 10s infinite ease-in-out;
  }

  @keyframes float {
    0%,
    100% {
      transform: translate(0, 0);
    }

    50% {
      transform: translate(20px, -20px);
    }
  }

  .blob-1 {
    top: -20%;
    left: -20%;
    width: 500px;
    height: 500px;
    background: #818cf8;
  }

  .blob-2 {
    bottom: -20%;
    right: -20%;
    width: 400px;
    height: 400px;
    background: #c084fc;
    animation-delay: 2s;
  }
</style>

<!-- Background Blobs -->
<div class="fixed inset-0 overflow-hidden pointer-events-none">
  <div class="blob blob-1 rounded-full"></div>
  <div class="blob blob-2 rounded-full"></div>
</div>

<div id="toast-container"></div>

<!-- Rubric Info Modal -->
<div id="rubricModal" class="fixed inset-0 z-[100] hidden line-height-normal">
  <div
    class="absolute inset-0 bg-slate-900/60 backdrop-blur-md transition-opacity duration-300"
    onclick="closeRubricModal()"
  ></div>
  <div
    class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-4xl p-4"
  >
    <div
      id="rubricModalContent"
      class="bg-white rounded-[32px] shadow-[0_32px_64px_-16px_rgba(0,0,0,0.3)] overflow-hidden border border-white/20 transform transition-all"
    >
      <div
        class="px-8 py-6 border-b border-slate-100 flex items-center justify-between bg-gradient-to-r from-slate-50/50 to-white"
      >
        <h3 class="font-bold text-slate-800 flex items-center gap-3 font-sans">
          <div
            class="w-10 h-10 bg-indigo-600 text-white rounded-2xl flex items-center justify-center shadow-lg shadow-indigo-600/30"
          >
            <i class="fa-solid fa-circle-info italic"></i>
          </div>
          <div class="flex flex-col">
            <span class="text-xl leading-tight font-black"
              >‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</span
            >
            <span
              class="text-[10px] text-slate-400 uppercase tracking-widest font-black"
              >Grading Standard Details</span
            >
          </div>
        </h3>
        <button
          onclick="closeRubricModal()"
          class="w-10 h-10 flex items-center justify-center rounded-2xl hover:bg-slate-100 text-slate-400 transition-all hover:rotate-90"
        >
          <i class="fa-solid fa-times text-lg"></i>
        </button>
      </div>
      <div
        id="rubricModalBody"
        class="p-6 max-h-[75vh] overflow-y-auto custom-scrollbar bg-slate-50/20 font-sans"
      >
        <!-- Content injected here -->
      </div>
      <div
        class="px-8 py-6 bg-white border-t border-slate-100 flex justify-end"
      >
        <button
          onclick="closeRubricModal()"
          class="px-12 py-3.5 bg-indigo-600 text-white rounded-2xl font-bold text-sm shadow-xl shadow-indigo-600/30 hover:scale-105 active:scale-95 transition-all"
        >
          ‡∏ï‡∏Å‡∏•‡∏á
        </button>
      </div>
    </div>
  </div>
</div>

<div class="flex flex-col lg:flex-row h-auto lg:h-full w-full p-4 gap-4">
  <!-- LEFT SIDEBAR: Control Panel -->
  <aside
    class="w-full lg:w-80 glass-panel shadow-xl flex flex-col rounded-[24px] overflow-hidden shrink-0 h-auto lg:h-full order-2 lg:order-1"
  >
    <div class="flex-1 overflow-y-auto p-6 scroll-smooth">
      <!-- Header -->
      <div
        class="flex items-center gap-2 mb-5 text-indigo-500 text-xs font-bold uppercase tracking-wider"
      >
        <i class="fa-solid fa-clipboard-check"></i> ‡∏ï‡∏£‡∏ß‡∏à Project
      </div>

      <!-- 1. Group Selection -->
      <div class="space-y-4 mb-6">
        <div>
          <label class="text-[10px] font-bold text-slate-400 ml-1 uppercase"
            >‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label
          >
          <div class="relative mt-1">
            <select
              id="groupSelect"
              class="w-full appearance-none bg-white border border-slate-200 rounded-xl px-4 py-3 text-sm focus:ring-2 focus:ring-indigo-500 outline-none cursor-pointer shadow-sm text-slate-700 font-medium"
            >
              <option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>
            </select>
            <div
              class="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none text-slate-400"
            >
              <i class="fa-solid fa-chevron-down text-xs"></i>
            </div>
          </div>
        </div>
      </div>

      <!-- 2. Reviewer Selection -->
      <div class="space-y-4 mb-6">
        <div>
          <label class="text-[10px] font-bold text-slate-400 ml-1 uppercase"
            >‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à</label
          >
          <div class="relative mt-1">
            <select
              id="reviewerSelect"
              disabled
              class="w-full appearance-none bg-white border border-slate-200 rounded-xl px-4 py-3 text-sm focus:ring-2 focus:ring-indigo-500 outline-none cursor-pointer shadow-sm text-slate-700 font-medium"
            >
              <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡πà‡∏≠‡∏ô --</option>
            </select>
            <div
              class="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none text-slate-400"
            >
              <i class="fa-solid fa-chevron-down text-xs"></i>
            </div>
          </div>
        </div>
      </div>

      <!-- 3. Team Selection -->
      <div class="space-y-4 mb-6">
        <div>
          <label class="text-[10px] font-bold text-slate-400 ml-1 uppercase"
            >‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</label
          >
          <div class="relative mt-1">
            <select
              id="teamSelect"
              disabled
              class="w-full appearance-none bg-white border border-slate-200 rounded-xl px-4 py-3 text-sm focus:ring-2 focus:ring-indigo-500 outline-none cursor-pointer shadow-sm text-slate-700 font-medium"
            >
              <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏Å‡πà‡∏≠‡∏ô --</option>
            </select>
            <div
              class="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none text-slate-400"
            >
              <i class="fa-solid fa-chevron-down text-xs"></i>
            </div>
          </div>
        </div>
      </div>

      <!-- Selected Info Card -->
      <div
        id="selectedInfoCard"
        class="hidden bg-gradient-to-r from-indigo-50 to-purple-50 border border-indigo-100 p-4 rounded-2xl shadow-sm animate-entry"
      >
        <div class="flex items-center gap-3 mb-3">
          <div
            class="w-10 h-10 bg-indigo-500 rounded-full flex items-center justify-center text-white font-bold shadow-md"
          >
            <i class="fa-solid fa-user-tie"></i>
          </div>
          <div class="flex-1 overflow-hidden">
            <p class="text-xs text-slate-400 font-bold uppercase">‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à</p>
            <p
              id="selectedReviewerName"
              class="text-sm font-bold text-slate-800 truncate"
            >
              -
            </p>
          </div>
        </div>
        <div class="flex items-center gap-3">
          <div
            class="w-10 h-10 bg-purple-500 rounded-full flex items-center justify-center text-white font-bold shadow-md"
          >
            <i class="fa-solid fa-users"></i>
          </div>
          <div class="flex-1 overflow-hidden">
            <p class="text-xs text-slate-400 font-bold uppercase">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà</p>
            <p
              id="selectedTeamNumber"
              class="text-sm font-bold text-slate-800 truncate"
            >
              -
            </p>
          </div>
        </div>
      </div>
    </div>
  </aside>

  <!-- RIGHT MAIN CONTENT: Student Table -->
  <main
    class="w-full lg:flex-1 overflow-visible lg:overflow-y-auto pl-0 lg:pl-0 order-3 lg:order-2"
  >
    <!-- Main Panel -->
    <div
      class="glass-panel rounded-[24px] h-[500px] lg:h-full flex flex-col overflow-hidden relative shadow-xl animate-entry mb-4 lg:mb-0"
      style="animation-delay: 0.2s"
    >
      <div
        class="p-5 border-b border-slate-100 flex justify-between items-center bg-white/60 backdrop-blur-md sticky top-0 z-10"
      >
        <h3 class="font-bold text-slate-700 flex items-center gap-3 text-lg">
          <div
            class="w-10 h-10 bg-gradient-to-br from-indigo-500 to-violet-600 p-2 rounded-lg text-white shadow-md shadow-indigo-500/20"
          >
            <i class="fa-solid fa-clipboard-list ml-1"></i>
          </div>
          ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤
        </h3>
        <button
          onclick="refreshStudentTable()"
          class="w-8 h-8 rounded-full hover:bg-slate-100 flex items-center justify-center text-slate-400 hover:text-indigo-600 transition"
        >
          <i class="fa-solid fa-rotate-right"></i>
        </button>
      </div>

      <!-- Student Tabs -->
      <div class="flex-1 flex flex-col overflow-hidden bg-white/40">
        <!-- Tabs Container -->
        <div
          id="studentTabsContainer"
          class="flex-none border-b border-slate-200 bg-white/60 backdrop-blur-sm overflow-x-auto scrollbar-hide"
        >
          <div id="studentTabs" class="flex gap-1 p-2 min-w-max">
            <!-- Empty State -->
            <div
              id="emptyTabsMessage"
              class="flex items-center justify-center w-full py-8 text-slate-400 italic"
            >
              <div class="flex flex-col items-center gap-3 opacity-60">
                <i
                  class="fa-solid fa-clipboard-question text-4xl text-slate-300"
                ></i>
                <span class="text-sm"
                  >‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à ‡πÅ‡∏•‡∏∞‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</span
                >
              </div>
            </div>
          </div>
        </div>

        <!-- Content Area -->
        <div class="flex-1 overflow-y-auto p-6">
          <div id="studentContent" class="mx-auto">
            <!-- Empty State -->
            <div
              id="emptyContentMessage"
              class="flex flex-col items-center justify-center h-full opacity-60"
            >
              <i
                class="fa-solid fa-hand-pointer text-6xl text-slate-300 mb-4"
              ></i>
              <p class="text-slate-400 text-center">
                ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏à‡∏≤‡∏Å‡πÅ‡∏ó‡πá‡∏ö‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- Score Modal -->
<div
  id="scoreModal"
  class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 modal-hide transition-all duration-300"
>
  <div
    class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm modal-backdrop"
    onclick="closeScoreModal()"
  ></div>
  <div
    class="modal-content bg-white rounded-[32px] shadow-2xl w-full max-w-md relative z-10 border border-white/50 overflow-hidden flex flex-col"
  >
    <div
      class="p-4 border-b border-slate-100 flex justify-between items-center bg-gradient-to-r from-slate-50 to-slate-100"
    >
      <h3 class="text-xl font-bold text-slate-800 flex items-center gap-2">
        <div
          class="w-10 h-10 bg-indigo-500 rounded-xl flex items-center justify-center text-white shadow-md"
        >
          <i class="fa-solid fa-star"></i>
        </div>
        ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô Project
      </h3>
      <button
        onclick="closeScoreModal()"
        class="w-10 h-10 bg-white hover:bg-slate-100 text-slate-400 hover:text-slate-600 rounded-full flex items-center justify-center transition shadow-sm"
      >
        <i class="fa-solid fa-xmark text-lg"></i>
      </button>
    </div>

    <div class="flex-1 overflow-y-auto p-6">
      <div
        id="studentInfo"
        class="bg-gradient-to-r from-indigo-50 to-purple-50 p-4 rounded-xl mb-6 border border-indigo-100"
      >
        <p class="text-xs text-slate-400 font-bold uppercase mb-1">‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</p>
        <p id="modalStudentId" class="text-sm font-mono text-slate-600"></p>
        <p id="modalStudentName" class="text-lg font-bold text-slate-800"></p>
      </div>

      <div class="space-y-4 mb-6">
        <div class="bg-white p-4 rounded-xl border border-slate-100 shadow-sm">
          <label class="block text-sm font-bold text-slate-700 mb-3"
            >‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (0-100)</label
          >
          <input
            type="number"
            id="scoreInput"
            min="0"
            max="100"
            step="0.5"
            placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô"
            class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-lg font-bold text-center focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition"
          />
        </div>
      </div>

      <button
        id="btnSaveScore"
        onclick="saveScore()"
        class="w-full btn-primary py-3 rounded-xl text-sm font-bold flex items-center justify-center gap-2"
      >
        <i class="fa-solid fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
      </button>
    </div>
  </div>
</div>

<script>
  let currentGroupIndex = null;
  let currentReviewer = null;
  let currentTeamNumber = null;
  let currentStudentId = null;
  let groupsData = [];
  let studentsData = [];

  // Toast Notification
  function showToast(msg, type = "success") {
    const t = document.createElement("div");
    t.className = `toast ${type}`;
    t.innerHTML = `<i class="fa-solid ${
      type === "success"
        ? "fa-circle-check text-emerald-500"
        : "fa-circle-xmark text-rose-500"
    } text-xl"></i><div><h4 class="font-bold text-slate-800 text-sm">${
      type === "success" ? "‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à" : "‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î"
    }</h4><p class="text-xs text-slate-500">${msg}</p></div>`;
    document.getElementById("toast-container").appendChild(t);
    setTimeout(() => t.classList.add("show"), 10);
    setTimeout(() => {
      t.classList.remove("show");
      setTimeout(() => t.remove(), 300);
    }, 3000);
  }

  const RUBRIC_DETAILS = {
    1: {
      title: "1Ô∏è‚É£ Problem Fit ‚Äî 30 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô",
      desc: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤",
      criteria: [
        {
          label: "Excellent (25‚Äì30)",
          detail:
            "‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏°‡∏≤‡∏Å ‡∏°‡∏µ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏™‡∏π‡∏á‡∏ï‡πà‡∏≠‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤/‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢ ‡∏£‡∏∞‡∏ö‡∏∏‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ä‡∏±‡∏î ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô",
        },
        {
          label: "Good (19‚Äì24)",
          detail: "‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ñ‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡∏ä‡∏±‡∏î ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡∏Ç‡∏≤‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å‡∏ö‡∏≤‡∏á‡∏à‡∏∏‡∏î",
        },
        {
          label: "Fair (13‚Äì18)",
          detail: "‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô ‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÑ‡∏°‡πà‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏à‡∏≤‡∏∞‡∏à‡∏á",
        },
        {
          label: "Poor (0‚Äì12)",
          detail: "‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÑ‡∏°‡πà‡∏ä‡∏±‡∏î ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Å‡∏±‡∏ö‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡∏Ç‡∏≠‡∏á‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢",
        },
      ],
    },
    2: {
      title: "2Ô∏è‚É£ Feasibility & MVP ‚Äî 30 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô",
      desc: "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ‡∏Ç‡∏≠‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï MVP",
      criteria: [
        {
          label: "Excellent (25‚Äì30)",
          detail: "‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° ‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô 1 ‡∏†‡∏≤‡∏Ñ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ‡∏°‡∏µ‡πÅ‡∏ú‡∏ô‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô",
        },
        {
          label: "Good (19‚Äì24)",
          detail: "‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏Ñ‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡∏à‡∏£‡∏¥‡∏á ‡πÅ‡∏ï‡πà‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏¢‡∏±‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÄ‡∏ß‡∏•‡∏≤/‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡πÑ‡∏°‡πà‡∏ä‡∏±‡∏î",
        },
        {
          label: "Fair (13‚Äì18)",
          detail: "‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡∏´‡∏£‡∏∑‡∏≠ MVP ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏±‡∏î",
        },
        {
          label: "Poor (0‚Äì12)",
          detail: "‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏™‡∏°‡∏à‡∏£‡∏¥‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ç‡∏µ‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏µ‡∏°",
        },
      ],
    },
    3: {
      title: "3Ô∏è‚É£ Agile Readiness ‚Äî 20 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô",
      desc: "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÉ‡∏ô Scrum ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö Agile",
      criteria: [
        {
          label: "Excellent (17‚Äì20)",
          detail:
            "‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ Scrum ‡πÑ‡∏î‡πâ‡∏î‡∏µ ‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Product Backlog / Sprint Plan",
        },
        {
          label: "Good (13‚Äì16)",
          detail: "‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à Agile ‡πÉ‡∏ô‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏Å‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î",
        },
        {
          label: "Fair (9‚Äì12)",
          detail: "‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÄ‡∏ä‡∏¥‡∏á‡∏ó‡∏§‡∏©‡∏é‡∏µ ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥",
        },
        {
          label: "Poor (0‚Äì8)",
          detail: "‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à Agile ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏•‡∏≤‡∏î‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô",
        },
      ],
    },
    4: {
      title: "4Ô∏è‚É£ Presentation & Individual Defense ‚Äî 20 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô",
      desc: "‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏£‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•",
      criteria: [
        {
          label: "Excellent (17‚Äì20)",
          detail: "‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡πÑ‡∏î‡πâ‡∏ï‡∏£‡∏á‡∏à‡∏∏‡∏î‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô",
        },
        {
          label: "Good (13‚Äì16)",
          detail: "‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢ ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÑ‡∏î‡πâ‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏´‡∏ç‡πà",
        },
        {
          label: "Fair (9‚Äì12)",
          detail: "‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏±‡∏î ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÑ‡∏î‡πâ‡∏ö‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô",
        },
        { label: "Poor (0‚Äì8)", detail: "‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠‡πÑ‡∏°‡πà‡∏ä‡∏±‡∏î ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ" },
      ],
    },
    5: {
      title: "5Ô∏è‚É£ Difficulty Bonus ‚Äî ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 5 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô",
      desc: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢‡πÄ‡∏ä‡∏¥‡∏á‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°",
      criteria: [
        {
          label: "‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å (5)",
          detail: "‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏î‡πâ‡∏≤‡∏ô Business Process / Security / Scalability",
        },
        { label: "‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á (3)", detail: "‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô" },
        { label: "‡∏ï‡πà‡∏≥ (1)", detail: "‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏Ñ‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô" },
        { label: "‡πÑ‡∏°‡πà‡∏°‡∏µ (0)", detail: "‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢‡∏î‡πâ‡∏≤‡∏ô‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°" },
      ],
    },
    6: {
      title: "6Ô∏è‚É£ Attractive Bonus ‚Äî ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 5 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô",
      desc: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á",
      criteria: [
        {
          label: "‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å (5)",
          detail: "UI/UX ‡∏î‡∏µ‡∏°‡∏≤‡∏Å ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢",
        },
        { label: "‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á (3)", detail: "‡∏ô‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏û‡∏≠‡∏™‡∏°‡∏Ñ‡∏ß‡∏£" },
        { label: "‡∏ï‡πà‡∏≥ (1)", detail: "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏î‡∏∂‡∏á‡∏î‡∏π‡∏î" },
        { label: "‡πÑ‡∏°‡πà‡∏°‡∏µ (0)", detail: "‡∏Ç‡∏≤‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à" },
      ],
    },
  };

  function showRubricInfo(id) {
    const data = RUBRIC_DETAILS[id];
    if (!data) return;

    const body = document.getElementById("rubricModalBody");
    let html = `
      <div class="mb-6">
        <div class="inline-block px-3 py-1 rounded-full bg-indigo-100 text-indigo-600 text-[10px] font-black uppercase tracking-widest mb-2">Section 0${id}</div>
        <h4 class="text-slate-800 font-bold text-2xl leading-tight">${
          data.title.split("‚Äî")[0]
        }</h4>
        <div class="h-1.5 w-12 bg-indigo-500 rounded-full mt-2 mb-3"></div>
        <p class="text-slate-500 text-sm font-medium italic">${data.desc}</p>
      </div>
      <div class="space-y-4">
    `;

    data.criteria.forEach((item) => {
      const isExcellent =
        item.label.includes("Excellent") || item.label.includes("‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å");
      const cardClass = isExcellent
        ? "bg-emerald-50 border-emerald-200 shadow-[0_4px_20px_-4px_rgba(16,185,129,0.15)] ring-1 ring-emerald-400/20"
        : "bg-white border-slate-100 shadow-sm";
      const labelClass = isExcellent
        ? "text-base font-black text-emerald-600"
        : "text-xs font-bold text-slate-400";
      const detailClass = isExcellent
        ? "text-slate-800 font-bold text-sm"
        : "text-slate-700 font-medium text-sm";

      html += `
        <div class="p-4 rounded-2xl border ${cardClass}">
          <div class="uppercase tracking-wider mb-1 flex items-center gap-2 ${labelClass}">
            ${
              isExcellent
                ? '<i class="fa-solid fa-crown text-emerald-500"></i>'
                : ""
            }
            ${item.label}
          </div>
          <div class="leading-relaxed ${detailClass}">${item.detail}</div>
        </div>
      `;
    });

    html += `</div>`;
    body.innerHTML = html;

    const modal = document.getElementById("rubricModal");
    const content = document.getElementById("rubricModalContent");

    modal.classList.remove("hidden");
    content.classList.add("animate-zoomIn");
  }

  function closeRubricModal() {
    const modal = document.getElementById("rubricModal");
    const content = document.getElementById("rubricModalContent");

    content.classList.remove("animate-zoomIn");
    modal.classList.add("hidden");
  }

  // Initial Load
  window.addEventListener("DOMContentLoaded", function () {
    loadGroups();

    // Event: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
    document
      .getElementById("groupSelect")
      .addEventListener("change", function () {
        const idx = this.value;
        if (idx !== "") {
          currentGroupIndex = parseInt(idx);
          resetStudentTabs(); // Reset tabs when group changes
          loadReviewers();
        } else {
          resetAll();
        }
      });

    // Event: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à
    document
      .getElementById("reviewerSelect")
      .addEventListener("change", function () {
        const reviewer = this.value;
        if (reviewer !== "") {
          currentReviewer = reviewer;
          drafts = {}; // ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‡∏ó‡∏¥‡πâ‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à
          hideSelectedInfo(); // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß
          resetStudentTabs();
          loadTeams(currentGroupIndex);
        } else {
          resetTeamSelection();
        }
      });

    // Event: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤
    document
      .getElementById("teamSelect")
      .addEventListener("change", function () {
        const teamNumber = this.value;
        if (teamNumber !== "") {
          currentTeamNumber = teamNumber;
          updateSelectedInfo();
          loadStudents();
        } else {
          hideSelectedInfo();
          resetStudentTabs();
        }
      });
  });

  // Listen for groups update from Main.html
  window.addEventListener("groupsUpdated", function (e) {
    groupsData = e.detail;
    updateGroupSelect();
  });

  // Load Groups
  function loadGroups() {
    google.script.run
      .withSuccessHandler(function (data) {
        groupsData = data;
        updateGroupSelect();
      })
      .getGroups();
  }

  // Update Group Select
  function updateGroupSelect() {
    const select = document.getElementById("groupSelect");
    select.innerHTML = '<option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>';
    groupsData.forEach((g, i) => {
      if (g.isActive !== false) {
        const opt = document.createElement("option");
        opt.value = i;
        opt.text = g.name;
        select.appendChild(opt);
      }
    });
  }

  // Load Reviewers
  function loadReviewers() {
    const select = document.getElementById("reviewerSelect");
    select.innerHTML = "";
    select.disabled = false;

    const reviewers = [
      { value: "teacher", label: "‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå" },
      { value: "joo", label: "‡∏à‡∏π" },
      { value: "poo", label: "‡∏†‡∏π" },
      { value: "khem", label: "‡πÄ‡∏Ç‡πâ‡∏°" },
      { value: "wan", label: "‡∏ß‡∏±‡∏ô" },
      { value: "boss", label: "‡∏ö‡∏≠‡∏™" },
    ];

    const defaultOpt = document.createElement("option");
    defaultOpt.value = "";
    defaultOpt.text = "-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --";
    select.appendChild(defaultOpt);

    reviewers.forEach((reviewer) => {
      const opt = document.createElement("option");
      opt.value = reviewer.value;
      opt.text = reviewer.label;
      select.appendChild(opt);
    });

    // Reset team selection
    resetTeamSelection();
  }

  // Load Teams
  function loadTeams(groupIndex) {
    const select = document.getElementById("teamSelect");
    select.innerHTML = '<option value="">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</option>';
    select.disabled = true;

    google.script.run
      .withSuccessHandler(function (teams) {
        select.innerHTML = '<option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>';
        select.disabled = false;

        teams.forEach((team) => {
          const opt = document.createElement("option");
          opt.value = team.teamNumber;
          opt.text = `‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà ${team.teamNumber}`;
          select.appendChild(opt);
        });
      })
      .withFailureHandler(function (error) {
        select.innerHTML = '<option value="">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</option>';
        showToast("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + error.message, "error");
      })
      .getScrumTeams(groupIndex);
  }

  // Load Students
  function loadStudents() {
    if (currentGroupIndex === null || !currentReviewer || !currentTeamNumber) {
      return;
    }

    const tabsContainer = document.getElementById("studentTabs");
    let emptyMessage = document.getElementById("emptyTabsMessage");

    // If emptyMessage doesn't exist, create it
    if (!emptyMessage) {
      emptyMessage = document.createElement("div");
      emptyMessage.id = "emptyTabsMessage";
      emptyMessage.className =
        "flex items-center justify-center w-full py-8 text-slate-400 italic";
      tabsContainer.innerHTML = "";
      tabsContainer.appendChild(emptyMessage);
    }

    // Show loading
    emptyMessage.classList.remove("hidden");
    emptyMessage.innerHTML = `
      <div class="flex flex-col items-center gap-3">
        <div class="relative">
          <div class="w-12 h-12 border-4 border-indigo-200 rounded-full"></div>
          <div class="w-12 h-12 border-4 border-indigo-600 rounded-full border-t-transparent animate-spin absolute top-0 left-0"></div>
        </div>
        <p class="text-sm font-medium text-slate-400">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
      </div>
    `;

    google.script.run
      .withSuccessHandler(function (result) {
        studentsData = result.students;
        renderStudentTabs(result.students);
      })
      .withFailureHandler(function (error) {
        showToast("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + error.message, "error");
        resetStudentTabs();
      })
      .getProjectCheckStudents(
        currentGroupIndex,
        currentReviewer,
        currentTeamNumber
      );
  }

  // Render Student Tabs
  function renderStudentTabs(students) {
    const tabsContainer = document.getElementById("studentTabs");
    let emptyMessage = document.getElementById("emptyTabsMessage");

    // If emptyMessage doesn't exist (e.g. after innerHTML reset), ignore toggle if not needed or create it
    if (!emptyMessage && (!students || students.length === 0)) {
      emptyMessage = document.createElement("div");
      emptyMessage.id = "emptyTabsMessage";
      emptyMessage.className =
        "flex items-center justify-center w-full py-8 text-slate-400 italic";
      tabsContainer.innerHTML = "";
      tabsContainer.appendChild(emptyMessage);
    }

    if (!students || students.length === 0) {
      if (emptyMessage) {
        emptyMessage.classList.remove("hidden");
        emptyMessage.innerHTML = `
          <div class="flex flex-col items-center gap-3 opacity-60">
            <i class="fa-solid fa-clipboard-question text-4xl text-slate-300"></i>
            <span class="text-sm">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</span>
          </div>
        `;
      }
      return;
    }

    // Hide empty message if it exists
    if (emptyMessage) {
      emptyMessage.classList.add("hidden");
    }

    // Render tabs
    let html = "";
    students.forEach((student, i) => {
      // ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï Draft ‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å Server ‡πÄ‡∏™‡∏°‡∏≠ (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏≤‡∏°‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à)
      drafts[student.id] = {
        scores: student.scores || [0, 0, 0, 0, 0, 0],
        notes: student.notes || ["", "", "", "", "", ""],
      };

      const hasScore = student.score !== null && student.score !== undefined;
      const activeClass =
        i === 0
          ? "bg-indigo-500 text-white shadow-md"
          : "bg-white text-slate-700 hover:bg-indigo-50";
      const scoreIndicator = hasScore
        ? '<i class="fa-solid fa-check-circle text-emerald-400 text-xs"></i>'
        : '<i class="fa-regular fa-circle text-slate-300 text-xs"></i>';

      html += `
        <button
          onclick="selectStudent(${i})"
          class="student-tab flex flex-col items-start px-4 py-3 rounded-xl transition-all duration-200 min-w-[180px] border border-slate-200 ${activeClass}"
          data-index="${i}"
        >
          <div class="flex items-center gap-2 w-full mb-1">
            ${scoreIndicator}
            <span class="font-mono text-xs font-bold">${student.id}</span>
          </div>
          <div class="text-sm font-medium truncate w-full text-left">${student.name}</div>
        </button>
      `;
    });

    tabsContainer.innerHTML = html;

    // Auto-select first student
    if (students.length > 0) {
      selectStudent(0);
    }
  }

  let drafts = {}; // { studentId: { scores: [], notes: [] } }

  // Select Student
  function selectStudent(index) {
    if (!studentsData || index >= studentsData.length) return;

    const student = studentsData[index];
    currentStudentId = student.id;

    // Initialize draft if not exists
    if (!drafts[student.id]) {
      drafts[student.id] = {
        scores: [0, 0, 0, 0, 0, 0],
        notes: ["", "", "", "", "", ""],
      };
    }

    // Update tab active state
    const tabs = document.querySelectorAll(".student-tab");
    tabs.forEach((tab, i) => {
      if (i === index) {
        tab.className =
          "student-tab flex flex-col items-start px-4 py-3 rounded-xl transition-all duration-200 min-w-[180px] border border-indigo-500 bg-indigo-500 text-white shadow-md";
      } else {
        tab.className =
          "student-tab flex flex-col items-start px-4 py-3 rounded-xl transition-all duration-200 min-w-[180px] border border-slate-200 bg-white text-slate-700 hover:bg-indigo-50";
      }
    });

    // Render student content
    renderStudentContent(student);
  }

  // Render Student Content
  function renderStudentContent(student) {
    const contentArea = document.getElementById("studentContent");
    const emptyMessage = document.getElementById("emptyContentMessage");

    if (emptyMessage) {
      emptyMessage.classList.add("hidden");
    }

    const draft = drafts[student.id];

    contentArea.innerHTML = `
      <div class="space-y-4 animate-entry pb-20">
        <!-- Grading Rubric -->
        <div class="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden text-slate-800">
          <!-- Header with Total Score -->
          <div class="bg-gradient-to-r from-slate-50 to-slate-100 px-4 py-3 border-b border-slate-200 flex items-center justify-between">
            <div class="flex flex-col">
              <h3 class="font-bold flex items-center gap-2 text-slate-800">
                <i class="fa-solid fa-clipboard-check text-indigo-500"></i>
                ‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô
              </h3>
              <p class="text-[10px] text-slate-500 font-medium ml-6">üìä Rubric ‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ (Pitching Day) 100 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (+ ‡πÇ‡∏ö‡∏ô‡∏±‡∏™ 10 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)</p>
            </div>
            <div class="flex items-center gap-2">
              <span class="text-xs text-slate-500">‡∏£‡∏ß‡∏°</span>
              <span id="totalScore" class="text-2xl font-bold text-indigo-600">${draft.scores
                .reduce((a, b) => a + b, 0)
                .toFixed(1)}</span>
              <span class="text-xs text-slate-400">/110</span>
            </div>
          </div>

          <!-- Compact Rubric Cards -->
          <div class="p-4 space-y-3 font-sans">
            <!-- Criterion 1: Problem Fit -->
            <div class="border border-blue-200 rounded-lg p-3 bg-blue-50/50 hover:bg-blue-50 transition">
              <div class="flex items-center justify-between mb-2">
                <div class="flex-1">
                  <div class="flex items-center gap-2">
                    <h4 class="text-lg font-bold">1. Problem Fit</h4>
                    <button onclick="showRubricInfo(1)" class="w-7 h-7 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center hover:bg-blue-200 transition-colors shadow-sm">
                      <i class="fa-solid fa-info text-xs"></i>
                    </button>
                  </div>
                  <p class="text-sm text-slate-600">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡πç‡∏≤‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤</p>
                </div>
                <div class="flex items-center gap-2">
                  <span id="score1Display" class="text-2xl font-bold text-blue-600 w-16 text-right">${draft.scores[0].toFixed(
                    1
                  )}</span>
                  <span class="text-sm text-slate-400">/30</span>
                </div>
              </div>
              <input type="range" id="score1" min="0" max="30" step="0.5" value="${
                draft.scores[0]
              }"
                class="w-full h-1.5 bg-blue-200 rounded-lg appearance-none cursor-pointer mb-2"
                oninput="updateDraft(1, this.value, 'score')">
              <textarea id="note1" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏..." rows="2" oninput="updateDraft(1, this.value, 'note')"
                class="w-full px-3 py-2.5 bg-white border border-blue-200 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition">${
                  draft.notes[0]
                }</textarea>
            </div>

            <!-- Criterion 2: Feasibility & MVP -->
            <div class="border border-emerald-200 rounded-lg p-3 bg-emerald-50/50 hover:bg-emerald-50 transition">
              <div class="flex items-center justify-between mb-2">
                <div class="flex-1">
                  <div class="flex items-center gap-2">
                    <h4 class="text-lg font-bold">2. Feasibility & MVP</h4>
                    <button onclick="showRubricInfo(2)" class="w-7 h-7 rounded-full bg-emerald-100 text-emerald-600 flex items-center justify-center hover:bg-emerald-200 transition-colors shadow-sm">
                      <i class="fa-solid fa-info text-xs"></i>
                    </button>
                  </div>
                  <p class="text-sm text-slate-600">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ‡∏Ç‡∏≠‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï MVP</p>
                </div>
                <div class="flex items-center gap-2">
                  <span id="score2Display" class="text-2xl font-bold text-emerald-600 w-16 text-right">${draft.scores[1].toFixed(
                    1
                  )}</span>
                  <span class="text-sm text-slate-400">/30</span>
                </div>
              </div>
              <input type="range" id="score2" min="0" max="30" step="0.5" value="${
                draft.scores[1]
              }"
                class="w-full h-1.5 bg-emerald-200 rounded-lg appearance-none cursor-pointer mb-2"
                oninput="updateDraft(2, this.value, 'score')">
              <textarea id="note2" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏..." rows="2" oninput="updateDraft(2, this.value, 'note')"
                class="w-full px-3 py-2.5 bg-white border border-emerald-200 rounded-lg text-sm focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 outline-none transition">${
                  draft.notes[1]
                }</textarea>
            </div>

            <!-- Criterion 3: Agile Readiness -->
            <div class="border border-purple-200 rounded-lg p-3 bg-purple-50/50 hover:bg-purple-50 transition">
              <div class="flex items-center justify-between mb-2">
                <div class="flex-1">
                  <div class="flex items-center gap-2">
                    <h4 class="text-lg font-bold">3. Agile Readiness</h4>
                    <button onclick="showRubricInfo(3)" class="w-7 h-7 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center hover:bg-purple-200 transition-colors shadow-sm">
                      <i class="fa-solid fa-info text-xs"></i>
                    </button>
                  </div>
                  <p class="text-sm text-slate-600">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÉ‡∏ô Scrum ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö Agile</p>
                </div>
                <div class="flex items-center gap-2">
                  <span id="score3Display" class="text-2xl font-bold text-purple-600 w-16 text-right">${draft.scores[2].toFixed(
                    1
                  )}</span>
                  <span class="text-sm text-slate-400">/20</span>
                </div>
              </div>
              <input type="range" id="score3" min="0" max="20" step="0.5" value="${
                draft.scores[2]
              }"
                class="w-full h-1.5 bg-purple-200 rounded-lg appearance-none cursor-pointer mb-2"
                oninput="updateDraft(3, this.value, 'score')">
              <textarea id="note3" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏..." rows="2" oninput="updateDraft(3, this.value, 'note')"
                class="w-full px-3 py-2.5 bg-white border border-purple-200 rounded-lg text-sm focus:ring-2 focus:ring-purple-500 focus:border-purple-500 outline-none transition">${
                  draft.notes[2]
                }</textarea>
            </div>

            <!-- Criterion 4: Presentation & Defense -->
            <div class="border border-orange-200 rounded-lg p-3 bg-orange-50/50 hover:bg-orange-50 transition">
              <div class="flex items-center justify-between mb-2">
                <div class="flex-1">
                  <div class="flex items-center gap-2">
                    <h4 class="text-lg font-bold">4. Presentation & Defense</h4>
                    <button onclick="showRubricInfo(4)" class="w-7 h-7 rounded-full bg-orange-100 text-orange-600 flex items-center justify-center hover:bg-orange-200 transition-colors shadow-sm">
                      <i class="fa-solid fa-info text-xs"></i>
                    </button>
                  </div>
                  <p class="text-sm text-slate-600">‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏£‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</p>
                </div>
                <div class="flex items-center gap-2">
                  <span id="score4Display" class="text-2xl font-bold text-orange-600 w-16 text-right">${draft.scores[3].toFixed(
                    1
                  )}</span>
                  <span class="text-sm text-slate-400">/20</span>
                </div>
              </div>
              <input type="range" id="score4" min="0" max="20" step="0.5" value="${
                draft.scores[3]
              }"
                class="w-full h-1.5 bg-orange-200 rounded-lg appearance-none cursor-pointer mb-2"
                oninput="updateDraft(4, this.value, 'score')">
              <textarea id="note4" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏..." rows="2" oninput="updateDraft(4, this.value, 'note')"
                class="w-full px-3 py-2.5 bg-white border border-orange-200 rounded-lg text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none transition">${
                  draft.notes[3]
                }</textarea>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
              <!-- Criterion 5: Difficulty Bonus -->
              <div class="border border-rose-200 rounded-lg p-3 bg-rose-50/50 hover:bg-rose-50 transition">
                <div class="flex items-center justify-between mb-2">
                  <div class="flex-1">
                    <div class="flex items-center gap-2">
                      <h4 class="text-base font-bold">5. Difficulty Bonus</h4>
                      <button onclick="showRubricInfo(5)" class="w-7 h-7 rounded-full bg-rose-100 text-rose-600 flex items-center justify-center hover:bg-rose-200 transition-colors shadow-sm">
                        <i class="fa-solid fa-info text-xs"></i>
                      </button>
                    </div>
                  </div>
                  <div class="flex items-center gap-2">
                    <span id="score5Display" class="text-xl font-bold text-rose-600 w-12 text-right">${draft.scores[4].toFixed(
                      1
                    )}</span>
                    <span class="text-xs text-slate-400">/5</span>
                  </div>
                </div>
                <input type="range" id="score5" min="0" max="5" step="0.5" value="${
                  draft.scores[4]
                }"
                  class="w-full h-1.5 bg-rose-200 rounded-lg appearance-none cursor-pointer mb-2"
                  oninput="updateDraft(5, this.value, 'score')">
                <textarea id="note5" placeholder="‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢‡∏¢‡∏±‡∏á‡πÑ‡∏á..." rows="1" oninput="updateDraft(5, this.value, 'note')"
                  class="w-full px-3 py-2 bg-white border border-rose-200 rounded-lg text-xs focus:ring-2 focus:ring-rose-500 focus:border-rose-500 outline-none transition">${
                    draft.notes[4]
                  }</textarea>
              </div>

              <!-- Criterion 6: Attractive Bonus -->
              <div class="border border-indigo-200 rounded-lg p-3 bg-indigo-50/50 hover:bg-indigo-50 transition">
                <div class="flex items-center justify-between mb-2">
                  <div class="flex-1">
                    <div class="flex items-center gap-2">
                      <h4 class="text-base font-bold">6. Attractive Bonus</h4>
                      <button onclick="showRubricInfo(6)" class="w-7 h-7 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center hover:bg-indigo-200 transition-colors shadow-sm">
                        <i class="fa-solid fa-info text-xs"></i>
                      </button>
                    </div>
                  </div>
                  <div class="flex items-center gap-2">
                    <span id="score6Display" class="text-xl font-bold text-indigo-600 w-12 text-right">${draft.scores[5].toFixed(
                      1
                    )}</span>
                    <span class="text-xs text-slate-400">/5</span>
                  </div>
                </div>
                <input type="range" id="score6" min="0" max="5" step="0.5" value="${
                  draft.scores[5]
                }"
                  class="w-full h-1.5 bg-indigo-200 rounded-lg appearance-none cursor-pointer mb-2"
                  oninput="updateDraft(6, this.value, 'score')">
                <textarea id="note6" placeholder="‡∏ô‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏á..." rows="1" oninput="updateDraft(6, this.value, 'note')"
                  class="w-full px-3 py-2 bg-white border border-indigo-200 rounded-lg text-xs focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition">${
                    draft.notes[5]
                  }</textarea>
              </div>
            </div>
          </div>
        </div>
      </div>
    `;

    showSaveFooter();
  }

  // Show Save Footer
  function showSaveFooter() {
    let footer = document.getElementById("saveActionFooter");
    if (!footer) {
      const mainPanel = document.querySelector("main .glass-panel");
      footer = document.createElement("div");
      footer.id = "saveActionFooter";
      footer.className =
        "absolute bottom-0 left-0 right-0 p-4 bg-white/80 backdrop-blur-md border-t border-slate-200 z-20 flex justify-end";
      footer.innerHTML = `
        <button
          onclick="saveDetailedScore()"
          class="btn-primary px-8 py-3 rounded-lg text-sm font-bold flex items-center justify-center gap-2 shadow-lg shadow-indigo-500/20"
        >
          <i class="fa-solid fa-cloud-arrow-up"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ô‡∏µ‡πâ)
        </button>
      `;
      mainPanel.appendChild(footer);
    }
  }

  // Update Draft data
  function updateDraft(criterionNum, value, type) {
    if (!currentStudentId || !drafts[currentStudentId]) return;

    if (type === "score") {
      const score = parseFloat(value);
      drafts[currentStudentId].scores[criterionNum - 1] = score;
      document.getElementById(`score${criterionNum}Display`).textContent =
        score.toFixed(1);
    } else {
      drafts[currentStudentId].notes[criterionNum - 1] = value;
    }

    calculateTotal();
  }

  // Calculate total for current student
  function calculateTotal() {
    if (!currentStudentId || !drafts[currentStudentId]) return;

    const total = drafts[currentStudentId].scores.reduce(
      (sum, s) => sum + s,
      0
    );
    const totalEl = document.getElementById("totalScore");
    if (totalEl) {
      totalEl.textContent = total.toFixed(1);
    }
  }

  // Save detailed score
  function saveDetailedScore() {
    if (
      currentGroupIndex === null ||
      !currentReviewer ||
      Object.keys(drafts).length === 0
    ) {
      showToast("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å", "warning");
      return;
    }

    const btn = event.currentTarget;
    btn.disabled = true;
    const originalHtml = btn.innerHTML;
    btn.innerHTML =
      '<i class="fa-solid fa-circle-notch fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô...';

    google.script.run
      .withSuccessHandler(function (result) {
        btn.disabled = false;
        btn.innerHTML = originalHtml;

        if (result.success) {
          showToast(`‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ (${result.count} ‡∏Ñ‡∏ô)`);

          // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï UI ‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
          drafts = {};
          studentsData = [];
          currentTeamNumber = null;
          currentStudentId = null;

          // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï Dropdown ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤
          const teamSelect = document.getElementById("teamSelect");
          if (teamSelect) teamSelect.value = "";

          // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• (‡∏•‡πâ‡∏≤‡∏á Tab ‡πÅ‡∏•‡∏∞‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤)
          resetStudentTabs();
          hideSelectedInfo();
        } else {
          showToast(result.msg || "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "error");
        }
      })
      .withFailureHandler(function (error) {
        btn.disabled = false;
        btn.innerHTML = originalHtml;
        showToast("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + error.message, "error");
      })
      .saveProjectCheckScore(currentGroupIndex, currentReviewer, drafts);
  }

  // Update Selected Info
  function updateSelectedInfo() {
    const reviewerSelect = document.getElementById("reviewerSelect");
    const reviewerText =
      reviewerSelect.options[reviewerSelect.selectedIndex].text;

    document.getElementById("selectedReviewerName").textContent = reviewerText;
    document.getElementById("selectedTeamNumber").textContent =
      "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà " + currentTeamNumber;
    document.getElementById("selectedInfoCard").classList.remove("hidden");
  }

  // Hide Selected Info
  function hideSelectedInfo() {
    document.getElementById("selectedInfoCard").classList.add("hidden");
  }

  // Reset Team Selection
  function resetTeamSelection() {
    const teamSelect = document.getElementById("teamSelect");
    teamSelect.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏Å‡πà‡∏≠‡∏ô --</option>';
    teamSelect.disabled = true;
    currentTeamNumber = null;
    hideSelectedInfo();
    resetStudentTabs();
  }

  // Reset Student Tabs
  function resetStudentTabs() {
    const tabsContainer = document.getElementById("studentTabs");
    let emptyMessage = document.getElementById("emptyTabsMessage");
    const contentArea = document.getElementById("studentContent");
    let emptyContentMessage = document.getElementById("emptyContentMessage");

    // Reset tabs
    if (tabsContainer) {
      // Create or update emptyMessage
      if (!emptyMessage) {
        emptyMessage = document.createElement("div");
        emptyMessage.id = "emptyTabsMessage";
        emptyMessage.className =
          "flex items-center justify-center w-full py-8 text-slate-400 italic";
      }

      emptyMessage.innerHTML = `
        <div class="flex flex-col items-center gap-3 opacity-60">
          <i class="fa-solid fa-clipboard-question text-4xl text-slate-300"></i>
          <span class="text-sm">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à ‡πÅ‡∏•‡∏∞‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</span>
        </div>
      `;

      tabsContainer.innerHTML = "";
      tabsContainer.appendChild(emptyMessage);
    }

    // Reset content
    if (contentArea) {
      contentArea.innerHTML = "";

      // Create or show emptyContentMessage
      if (!emptyContentMessage) {
        emptyContentMessage = document.createElement("div");
        emptyContentMessage.id = "emptyContentMessage";
        emptyContentMessage.className =
          "flex flex-col items-center justify-center h-full opacity-60";
        emptyContentMessage.innerHTML = `
          <i class="fa-solid fa-hand-pointer text-6xl text-slate-300 mb-4"></i>
          <p class="text-slate-400 text-center">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏à‡∏≤‡∏Å‡πÅ‡∏ó‡πá‡∏ö‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô</p>
        `;
        contentArea.appendChild(emptyContentMessage);
      } else {
        emptyContentMessage.classList.remove("hidden");
      }
    }
  }

  // Refresh Student Table
  function refreshStudentTable() {
    if (currentTeamNumber) {
      const icon = event.currentTarget.querySelector("i");
      icon.classList.add("fa-spin");
      loadStudents();
      setTimeout(() => icon.classList.remove("fa-spin"), 1000);
    }
  }

  // Reset All
  function resetAll() {
    currentGroupIndex = null;
    currentReviewer = null;
    currentTeamNumber = null;
    currentStudentId = null;

    const reviewerSelect = document.getElementById("reviewerSelect");
    reviewerSelect.innerHTML =
      '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡πà‡∏≠‡∏ô --</option>';
    reviewerSelect.disabled = true;

    resetTeamSelection();
  }
</script>
